{"ast":null,"code":"import _objectSpread from\"/home/serban/Desktop/bytes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/serban/Desktop/bytes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/serban/Desktop/bytes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/serban/Desktop/bytes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useState,useEffect,useContext}from\"react\";import{useHistory}from\"react-router-dom\";import{ByteContext}from\"../context/bytes\";import{CartContext}from\"../context/cart\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import{UserContext}from\"../context/user\";var CARD_ELEMENT_OPTIONS={style:{base:{color:\"#32325d\",fontFamily:'\"Helvetica Neue\", Helvetica, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var CheckoutForm=function CheckoutForm(){var _useContext=useContext(CartContext),cart=_useContext.cart,total=_useContext.total,clearCart=_useContext.clearCart,transferCartToOwner=_useContext.transferCartToOwner;var _useContext2=useContext(ByteContext),checkout=_useContext2.checkout;var _useContext3=useContext(UserContext),getUserEmail=_useContext3.getUserEmail;var _useState=useState({cart:cart,total:total,address:null,token:null}),_useState2=_slicedToArray(_useState,2),orderDetails=_useState2[0],setOrderDetails=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var stripe=useStripe();var elements=useElements();var history=useHistory();useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return checkout(orderDetails);case 2:_context.next=4;return transferCartToOwner(getUserEmail());case 4:_context.next=6;return clearCart();case 6:history.push(\"/\");case 7:case\"end\":return _context.stop();}}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();if(orderDetails.token){fetchData();}},[orderDetails]);// Handle real-time validation errors from the card Element.\nvar handleChange=function handleChange(event){if(event.error){setError(event.error.message);}else{setError(null);}};// Handle form submission.\nvar handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var card,result,token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();card=elements.getElement(CardElement);_context2.next=4;return stripe.createToken(card);case 4:result=_context2.sent;if(result.error){// Inform the user if there was an error.\nsetError(result.error.message);}else{setError(null);// Send the token to your server.\ntoken=result.token;setOrderDetails(_objectSpread(_objectSpread({},orderDetails),{},{token:token.id}));}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-form\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"checkout-address\",children:\"Shipping Address\"}),/*#__PURE__*/_jsx(\"input\",{id:\"checkout-address\",type:\"text\",onChange:function onChange(e){return setOrderDetails(_objectSpread(_objectSpread({},orderDetails),{},{address:e.target.value}));}}),/*#__PURE__*/_jsxs(\"div\",{className:\"stripe-section\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"stripe-element\",children:\" Credit or debit card \"}),/*#__PURE__*/_jsx(CardElement,{id:\"stripe-element\",options:CARD_ELEMENT_OPTIONS,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-errors\",role:\"alert\",children:error})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn\",children:\"Submit Payment\"})]});};export default CheckoutForm;","map":{"version":3,"sources":["/home/serban/Desktop/bytes/src/components/CheckoutForm.js"],"names":["React","useState","useEffect","useContext","useHistory","ByteContext","CartContext","CardElement","useElements","useStripe","UserContext","CARD_ELEMENT_OPTIONS","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","CheckoutForm","cart","total","clearCart","transferCartToOwner","checkout","getUserEmail","address","token","orderDetails","setOrderDetails","error","setError","stripe","elements","history","fetchData","push","handleChange","event","message","handleSubmit","preventDefault","card","getElement","createToken","result","id","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { ByteContext } from \"../context/bytes\";\nimport { CartContext } from \"../context/cart\";\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport { UserContext } from \"../context/user\";\n\nconst CARD_ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      color: \"#32325d\",\n      fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n      fontSmoothing: \"antialiased\",\n      fontSize: \"16px\",\n      \"::placeholder\": {\n        color: \"#aab7c4\"\n      }\n    },\n    invalid: {\n      color: \"#fa755a\",\n      iconColor: \"#fa755a\"\n    }\n  }\n};\n\nconst CheckoutForm = () => {\n  const { cart, total, clearCart, transferCartToOwner } = useContext(CartContext);\n  const { checkout } = useContext(ByteContext);\n  const { getUserEmail } = useContext(UserContext);\n  const [orderDetails, setOrderDetails] = useState({ cart, total, address: null, token: null });\n  const [error, setError] = useState(null);\n  const stripe = useStripe();\n  const elements = useElements();\n  const history = useHistory();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await checkout(orderDetails);\n      await transferCartToOwner(getUserEmail());\n      await clearCart();\n      history.push(\"/\");\n    }\n\n    if (orderDetails.token) {\n      fetchData();\n    }\n  }, [orderDetails]);\n\n  // Handle real-time validation errors from the card Element.\n  const handleChange = (event) => {\n    if (event.error) {\n      setError(event.error.message);\n    } else {\n      setError(null);\n    }\n  };\n\n  // Handle form submission.\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    const card = elements.getElement(CardElement);\n    const result = await stripe.createToken(card);\n    if (result.error) {\n      // Inform the user if there was an error.\n      setError(result.error.message);\n    } else {\n      setError(null);\n      // Send the token to your server.\n      const token = result.token;\n      setOrderDetails({ ...orderDetails, token: token.id });\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <div className=\"checkout-form\">\n        <label htmlFor=\"checkout-address\">Shipping Address</label>\n        <input\n          id=\"checkout-address\"\n          type=\"text\"\n          onChange={(e) => setOrderDetails({ ...orderDetails, address: e.target.value })}\n        />\n        <div className=\"stripe-section\">\n          <label htmlFor=\"stripe-element\"> Credit or debit card </label>\n          <CardElement id=\"stripe-element\" options={CARD_ELEMENT_OPTIONS} onChange={handleChange} />\n        </div>\n        <div className=\"card-errors\" role=\"alert\">\n          {error}\n        </div>\n      </div>\n      <button type=\"submit\" className=\"btn\">\n        Submit Payment\n      </button>\n    </form>\n  );\n};\n\nexport default CheckoutForm;\n"]},"metadata":{},"sourceType":"module"}